{% extends "mercurial/base.html" %}

{% block title %}{{p.title}}{% endblock %}
{% block body %}
<form method="post" action="{{p.url}}/commit/{{p.hg.filename}}">
  <div class="alert alert-danger">
    <strong>Attention!</strong> Make sure your changes are valid before the commit
  </div>

  <table class="table table-hover table-responsive">
    <tr>
      <td>
          <div class="col-sm-2 text-right">
              <b>filepath</b>
          </div>
          <div class="col-sm-10">
              {{p.hg.filepath}}
          </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="col-sm-2 text-right">
            <b>status</b>
        </div>
        <div class="col-sm-2">
          {% if p.hg.log.status == "M" %}
            <span class="text-danger"><b>Modified</b></span>
          {% else %}
            {{p.hg.log.status}}
          {% endif %}
        </div>
        <div class="col-sm-2 text-right">
            <b>last commit</b>
        </div>
        <div class="col-sm-6">
          <small>{{p.hg.log.updated|string|dt}}, </small>  {{p.hg.log.updated_by}}
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="col-sm-2 text-right">
            <b>diff</b>
        </div>

        <div class="col-sm-10">
          <textarea name="content" id="content">{{p.hg.diff|safe}}</textarea>
          <div id="editor_content" style="min-height: 250px"></div>
          <script>
              var editor_content = ace.edit("editor_content");
              editor_content.setTheme("ace/theme/monokai");
              editor_content.getSession().setMode("ace/mode/diff");
              var textarea_content = $('#content').hide();
              editor_content.getSession().setValue(textarea_content.val());
              editor_content.getSession().on('change', function(){
                textarea_content.val(editor_content.getSession().getValue());
              });
              editor_content.commands.addCommand({
                name: 'saveFile',
                bindKey: { win: 'Ctrl-S', mac: 'Command-S', sender: 'editor|cli' },
                exec: function(env, args, request) { form.submit(); }
              });
          </script>
        </div>
      </td>
    </tr>

    <tr>
      <td>
        <div class="col-sm-2 text-right">
            <b>comment</b>
        </div>
        <div class="col-sm-10">
          <textarea id="comment" name="comment" class="form-control" rows=5></textarea>
        </div>
      </td>
    </tr>
  </table>

  <div class="form-group">
    <div class="col-sm-10 col-sm-offset-2">
      <button type="button" class="btn btn-primary"
          onclick="location='{{p.url}}/view/{{p.hg.filename}}'">
        <i class="fa fa-arrow-left" aria-hidden="true"></i> Back
      </button>
      <button type="submit" class="btn btn-danger">
        Commit
      </button>
    </div>
  </div>
</form>
{% endblock %}
